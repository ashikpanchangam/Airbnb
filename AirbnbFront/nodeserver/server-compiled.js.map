{"version":3,"sources":["server.js"],"names":[],"mappings":"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","file":"server-compiled.js","sourcesContent":["import express from 'express';\nimport cors from 'cors';\nimport bodyParser from 'body-parser';\nimport session from 'express-session';\nimport passport from 'passport';\nimport massive from 'massive';\nimport path from 'path';\nimport request from 'request';\nimport moment from 'moment'\n\nvar inspect = require('eyespect').inspector();\nvar airbnb = require('airapi');\n\n// Configs\n// import serverConfig from './config.json';\n\n// const connectionString = serverConfig.postgresPath; //database path\nconst app = module.exports = express();\n\napp.use(express.static(__dirname + '/../public'));\n\napp.use('/node_modules', express.static('./node_modules'));\nvar http = require('http').Server(app);\nvar io = require('socket.io')(http);\n\napp.use(session({\n    secret: 'Sid', //session secret\n    saveUninitialized: false,\n    resave: true\n}));\n\napp.use(passport.initialize());\napp.use(passport.session());\napp.use(cors());\napp.use(bodyParser.json({\n    limit: '50mb'\n}));\napp.use(bodyParser.urlencoded({\n    limit: '50mb',\n    extended: true\n}));\n\npassport.serializeUser(function(user, done) {\n    done(null, user);\n});\n\npassport.deserializeUser(function(user, done) {\n    done(null, user);\n});\n\napp.post('/login', (req, response, next) => {\n\n  var config = {\"X-Airbnb-OAuth-Token\": \"446qdnlk8o0j79zjz4py8mrum\"};\n  var data = {\n    client_id: \"d306zoyjsyarp7ifhu67rjxn52tv0t20\",\n    currency: 'USD',\n    grant_type: 'password',\n    locale: \"en-US\",\n    username: req.body.email,\n    password: req.body.password\n  };\n  var options = {\n    method: 'post',\n    url: 'https://api.airbnb.com/v1/authorize',\n    body: data,\n    json: true,\n  };\n\n  request(options, (err, res, body) => {\n    if (err) inspect(err, 'error at jsoning');\n   req.session.token = body.access_token;\n    var headers = res.headers\n    var statusCode = res.statusCode\n    inspect(headers, 'headers')\n    inspect(statusCode, 'statusCode')\n    inspect(body, 'body')\n\n    options.method = 'get'\n    options.url = 'https://api.airbnb.com/v1/account/active'\n    options.headers = {\"X-Airbnb-OAuth-Token\": req.session.token}\n    options.data = null\n\n    // request(options, (err, res, body) => {\n    //   req.session.data = body\n    //   return response.json(\"data\": req.session.data);\n    // })\n\n  })\n})\n\napp.get('/dashboard', (req, res, next) => {\n  res.json({\"data\": req.session.data});\n})\n\napp.get('/getMessages', (req, response, next) => {\n\n  if(req.session.token === undefined){\n    req.session.token = '446qdnlk8o0j79zjz4py8mrum'\n    console.log('req.session.token: ', req.session.token)\n  }\n\n  const options = {\n  method: 'GET',\n  url: 'https://api.airbnb.com/v1/threads?locale=en-US&client_id=3092nxybyb0otqw18e8nh5nty&offset=0&items_per_page=10&currency=USD&role=guest',\n  headers: {\"X-Airbnb-OAuth-Token\": req.session.token},\n  json: true,\n}\n\nrequest(options, (err, res, body) => {\n  if(err){ console.log(err)}\n  console.log('res.body: ', res.body)\n    return response.json({\"threads\": res.body.threads})\n  })\n})\n\napp.get('/getData', (req, res, next) => {\n    if (req.session.searchResults) {\n        res.json(req.session.searchResults);\n    } else {\n      airbnb.search({\n          location: 'Manila',\n          checkin: '10/24/2016',\n          checkout: '10/31/2016',\n          guests: 2,\n          page: 2,\n      }).then(function(searchResults) {\n\n        searchResults.location = 'Manila'\n        searchResults.startDate = '10/24/2016'\n        searchResults.endDate = '10/31/2016'\n        searchResults.numGuests = 1\n        res.json(searchResults);\n      });\n    }\n});\n\napp.get('/viewUser/:id', (req, response, next) => {\n  console.log('Params: ' , req.params)\n  const options = {\n  method: 'get',\n  url: `https://api.airbnb.com/v2/users/${req.params.id}?client_id=3092nxybyb0otqw18e8nh5nty&_format=v1_legacy_show`,\n  headers: {'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'},\n  json: true\n}\n\nrequest(options, (err, res, body) => {\n  // console.log('user res: ', res)\n  // console.log('user body: ', body)\n  response.json({'succces': body})\n})\n\n})\n\napp.post('/search', (req, res, next) => {\n\n    airbnb.search({\n        location: req.body.searchVal,\n        checkin: req.body.startDate,\n        checkout: req.body.endDate,\n        guests: req.body.numGuests,\n        page: Math.round(Math.random()*10),\n        room_types: req.body.room_types,\n        price_min: req.body.price_min,\n        price_max: req.body.price_max\n    }).then(function(searchResults) {\n        searchResults.location = req.body.searchVal\n        searchResults.startDate = req.body.startDate\n        searchResults.endDate = req.body.endDate\n        searchResults.numGuests = req.body.numGuests\n\n        req.session.searchResults = searchResults;\n        console.log(searchResults.results_json.search_results[0]);\n        res.json(searchResults);\n    });\n})\n\n\napp.post('/sendMessage', (req, res, next) => {\n\n  // THIS NEEDS TO HAVE NEW DATA\n  console.log(req.body)\n  var config = {\"X-Airbnb-OAuth-Token\": \"ay8njrze1oalc9wgyfp26e67j\"};\n\n  var data = {\n    listing_id: req.body.id,\n    number_of_guests: \"1\",\n    client_id: \"d306zoyjsyarp7ifhu67rjxn52tv0t20\",\n    currency: 'USD',\n    checkout_date: \"2018-04-02T22:00:00.000-0700\",\n    checkin_date: \"2018-04-01T00:00:00.000-0700\",\n    locale: \"en-US\",\n    message: req.body.message\n  };\n\n  var options = {\n    method: 'post',\n    url: 'https://api.airbnb.com/v1/threads/create',\n    headers: {\n      'X-Airbnb-OAuth-Token': 'ay8njrze1oalc9wgyfp26e67j'\n    },\n    body: data,\n    json: true\n  };\n  console.log('data to be sent:', data)\nrequest(options, function(err, res, body) {\n  console.log('body: ',body)\n  if (err) {inspect(err, 'error at jsoning')\n    console.log(err)\n  };\n  var headers = res.headers\n  var statusCode = res.statusCode\n})\n})\n\n\napp.get('/listingInfo/:rid', (req,res,next) => {\n  console.log(req.params)\n  airbnb.getInfo(req.params.rid).then(function(info) {\n    console.log(\"info: \", info);\n    res.json(info);\n  });\n})\n\n\napp.get('*', function(request, response) {\n    response.sendFile(path.resolve(__dirname, '../public', 'index.html'))\n});\n\nhttp.listen(3000, function() {\n    console.log('Hosting port: ', 3000);\n});\n"]}